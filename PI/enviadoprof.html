<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário Enviado</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Link CDN do jsPDF -->
</head>

<body>

    <link rel="stylesheet" type="text/css"
        href="https://saopaulo.sp.gov.br/barra-govsp/css/top-padrao-govsp-v2.min.css?vs=3.0">
    <section class="govsp-topo">
        <div id="govsp-topbarGlobal" class="blu-e">
            <div id="topbarGlobal">
                <div id="topbarLink" class="govsp-black">
                    <div class="govsp-portal">
                        <a href="https://www.saopaulo.sp.gov.br" title="nova guia Site Governo do Estado de São Paulo"
                            target="_blank"><img
                                src="https://saopaulo.sp.gov.br/barra-govsp/img/logo-governo-do-estado-sp.png"
                                alt="logomarca Governo de São Paulo" height="38" class="logo">
                        </a>
                    </div>
                </div>
                <nav class="govsp-navbar govsp-navbar-expand-lg">
                    <a class="govsp-link digital" href="https://spmaisdigital.sp.gov.br" title="site SP + Digital">SP +
                        Digital</a>

                    <a class="govsp-social" href="https://www.flickr.com/governosp/"><img class="govsp-icon-social"
                            src="https://saopaulo.sp.gov.br/barra-govsp/img/i-flickr.png"
                            alt="Flickr Governo do Estado de SP" /></a>

                    <a class="govsp-social" href="https://www.linkedin.com/company/governosp/"><img
                            class="govsp-icon-social" src="https://saopaulo.sp.gov.br/barra-govsp/img/i-linkedin.png"
                            alt="Linkedin Governo do Estado de SP" /></a>

                    <a class="govsp-social" href="https://www.tiktok.com/@governosp"><img class="govsp-icon-social"
                            src="https://saopaulo.sp.gov.br/barra-govsp/img/i-tiktok.png"
                            alt="TikTok Governo do Estado de SP" /></a>

                    <a class="govsp-social" href="https://www.youtube.com/governosp/"><img class="govsp-icon-social"
                            src="https://saopaulo.sp.gov.br/barra-govsp/img/i-youtube.png"
                            alt="Youtube Governo do Estado de SP" /></a>

                    <a class="govsp-social" href="https://www.twitter.com/governosp/"><img class="govsp-icon-social"
                            src="https://saopaulo.sp.gov.br/barra-govsp/img/i-twitter.png"
                            alt="Twitter Governo do Estado de SP" /></a>

                    <a class="govsp-social" href="https://www.instagram.com/governosp/"><img class="govsp-icon-social"
                            src="https://saopaulo.sp.gov.br/barra-govsp/img/i-insta.png"
                            alt="Instagram Governo do Estado de SP" /></a>

                    <a class="govsp-social" href="https://www.facebook.com/governosp/"><img class="govsp-icon-social"
                            src="https://saopaulo.sp.gov.br/barra-govsp/img/i-facebook.png"
                            alt="Facebook Governo do Estado de SP" /></a>

                    <p class="govsp-social">/governosp</p>

                    <a class="govsp-acessibilidade" title="nova guia"
                        href="https://www.saopaulo.sp.gov.br/fale-conosco/comunicar-erros/" target="_blank"><img
                            class="govsp-acessibilidade"
                            src="https://saopaulo.sp.gov.br/barra-govsp/img/i-error-report.png"
                            alt="Comunicar um erro"></a>
                </nav>
            </div>
            <button class="govsp-kebab" id="govsp-kebab" aria-expanded="false"><img
                    src="https://saopaulo.sp.gov.br/barra-govsp/img/dots-menu.png" alt="Menu"></button>

            <ul class="govsp-dropdown vs3" id="govsp-dropdown" aria-hidden="true">
                <li><a class="govsp-link digital" role="button" href="https://spmaisdigital.sp.gov.br"
                        title="Site SP + Digital">SP + Digital</a></li>

                <li><a class="govsp-social" role="button" href="https://www.flickr.com/governosp/"><img
                            class="govsp-icon-social" src="https://saopaulo.sp.gov.br/barra-govsp/img/i-flickr.png"
                            alt="Flickr Governo do Estado de SP" /></a></li>

                <li><a class="govsp-social" role="button" href="https://www.linkedin.com/company/governosp/"><img
                            class="govsp-icon-social" src="https://saopaulo.sp.gov.br/barra-govsp/img/i-linkedin.png"
                            alt="Linkedin Governo do Estado de SP" /></a></li>

                <li><a class="govsp-social" role="button" href="https://www.tiktok.com/@governosp"><img
                            class="govsp-icon-social" src="https://saopaulo.sp.gov.br/barra-govsp/img/i-tiktok.png"
                            alt="TikTok Governo do Estado de SP" /></a></li>

                <li><a class="govsp-social" role="button" href="https://www.twitter.com/governosp/"><img
                            class="govsp-icon-social" src="https://saopaulo.sp.gov.br/barra-govsp/img/i-twitter.png"
                            alt="Twitter Governo do Estado de SP" /></a></li>

                <li><a class="govsp-social" role="button" href="https://www.youtube.com/governosp/"><img
                            class="govsp-icon-social" src="https://saopaulo.sp.gov.br/barra-govsp/img/i-youtube.png"
                            alt="Youtube Governo do Estado de SP" /></a></li>

                <li><a class="govsp-social" role="button" href="https://www.instagram.com/governosp/"><img
                            class="govsp-icon-social" src="https://saopaulo.sp.gov.br/barra-govsp/img/i-insta.png"
                            alt="Instagram Governo do Estado de SP" /></a></li>

                <li><a class="govsp-social" role="button" href="https://www.facebook.com/governosp/"><img
                            class="govsp-icon-social" src="https://saopaulo.sp.gov.br/barra-govsp/img/i-facebook.png"
                            alt="Facebook Governo do Estado de SP" /></a></li>

                <li>
                    <p class="govsp-social">/governosp</p>
                </li>
            </ul>
        </div>

        <script src="https://saopaulo.sp.gov.br/barra-govsp/js/script-top-v2.js?vs=3.0"></script>
        <noscript>
            Seu navegador não tem suporte a JavaScript ou está desativado!</noscript>
    </section>

    <div class="logos">
        <img src="logo_fatec_cor.png" width="13%" alt="">
        <img src="cps.png" width="14%" alt="">
    </div>

    <nav>
        <ul>
            <li><a href="login.html">Voltar para o Login</a></li>
            <li><a href="edital.html">Inscrição</a></li>
            <li><a href="enviadoprof.html">Acompanhamento</a></li>
        </ul>
    </nav>


    <!-- Tabela com os dados enviados -->
    <div class="central">
        <table border="1">
            <thead>
                <tr>
                    <th>Id</th>
                    <th>Nome do Professor</th>
                    <th>Data de Envio</th>
                    <th>Tipo de Atividade</th>
                    <th>Status</th>
                    <th>Relatório</th> <!-- Nova coluna Relatório -->
                    <th>Edital</th>
                    <th>Arquivo</th>
                </tr>
            </thead>
            <tbody id="formTableBody">
                <!-- Linhas serão adicionadas aqui dinamicamente -->
            </tbody>
        </table>
        <!-- Modal de Edição do Formulário -->
        <div id="editModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeEditForm()">&times;</span>
                <h2>Editar Informações</h2>
                <form id="editForm" class="editForm">
                    <label for="edit-id">ID:</label>
                    <input type="text" id="edit-id" name="id" disabled><br>

                    <label for="edit-name">Nome do Professor:</label>
                    <input type="text" id="edit-name" name="professor"><br>

                    <label for="edit-date">Data de Envio:</label>
                    <input type="text" id="edit-date" name="date" disabled><br>

                    <label for="edit-type">Título da HAE:</label>
                    <input type="text" id="edit-type" name="title"><br>

                    <button type="submit">Salvar</button>
                </form>
            </div>
        </div>
    </div>
    
    </div>

    <script>
        // Recuperar os dados do localStorage
        const formData = JSON.parse(localStorage.getItem("formData"));

        if (formData) {
            // Adicionar os dados na tabela
            const tableBody = document.getElementById("formTableBody");

            const newRow = tableBody.insertRow();

            // Adicionar células à nova linha
            newRow.insertCell().textContent = new Date().getTime(); // Id gerado com base no timestamp
            newRow.insertCell().textContent = formData.professor;
            newRow.insertCell().textContent = new Date().toLocaleString(); // Data de envio
            newRow.insertCell().textContent = formData.tipoHAE; // Título da HAE

            // Criar célula para o Status (Somente exibição para o professor)
            const statusCell = newRow.insertCell();
            const statusText = document.createElement("span");
            statusText.textContent = "Status não definido"; // O status inicial

            // Atribuir o status conforme o coordenador (exemplo)
            // Aqui podemos ter uma lógica mais elaborada, por enquanto estamos mostrando o status do formulário
            // com base no que foi enviado pelo coordenador. Por exemplo, podemos simular com dados no localStorage.
            const status = formData.status || "deferido";  // Caso não tenha, ele assume "definido"
            switch (status) {
                case "deferido":
                    statusText.textContent = "Deferido";
                    statusText.style.color = "green";
                    break;
                case "indeferido":
                    statusText.textContent = "Indeferido";
                    statusText.style.color = "red";
                    break;
                case "parcial":
                    statusText.textContent = "Parcial";
                    statusText.style.color = "orange";
                    break;
                default:
                    statusText.textContent = "Status não definido";
                    break;
            }

            statusCell.appendChild(statusText);

            // Criar a célula para o botão de upload de arquivo
            const uploadCell = newRow.insertCell();
            const uploadButton = document.createElement('label');
            uploadButton.classList.add('upload-btn');  // Adiciona a classe estilizada

            // Adiciona o ícone ao botão
            uploadButton.innerHTML = `
                Enviar
                <input type="file" id="file-upload-${newRow.rowIndex}" accept="application/pdf, image/*, .docx, .xlsx" onchange="updateFileName(event, ${newRow.rowIndex})">
            `;

            // Adicionar o nome do arquivo ao lado do botão
            const fileNameDisplay = document.createElement('span');
            fileNameDisplay.classList.add('file-name');
            fileNameDisplay.id = `file-name-${newRow.rowIndex}`;
            uploadCell.appendChild(uploadButton);
            uploadCell.appendChild(fileNameDisplay);

            // Criar a célula para o botão de download
            const downloadCell = newRow.insertCell();
            const downloadButton = document.createElement('button');
            downloadButton.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" height="50px" viewBox="0 -960 960 960" width="50px" fill="#e8eaed">
                    <path d="M480-320 280-520l56-58 104 104v-326h80v326l104-104 56 58-200 200ZM240-160q-33 0-56.5-23.5T160-240v-120h80v120h480v-120h80v120q0 33-23.5 56.5T720-160H240Z"/>
                </svg>
            `;
            downloadButton.addEventListener('click', function () {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                // Adicionar título do PDF
                doc.text("Formulário Enviado", 20, 20);

                // Adicionar os dados do formulário ao PDF
                let yPosition = 30;
                for (const key in formData) {
                    if (formData.hasOwnProperty(key)) {
                        doc.text(`${key}: ${formData[key]}`, 20, yPosition);
                        yPosition += 10;
                    }
                }

                doc.save("formulario_enviado.pdf");
            });
            downloadCell.appendChild(downloadButton);

            // Criar a célula para o botão de editar
            const editCell = newRow.insertCell();
            const editButton = document.createElement('button');
            editButton.textContent = 'Editar';

            // Adicionar o evento de clique para o botão de editar
            editButton.addEventListener('click', function () {
                // A função openEditForm agora é chamada com os dados da linha
                openEditForm(newRow.cells[0].textContent, newRow.cells[1].textContent, newRow.cells[2].textContent, newRow.cells[3].textContent);
            });
            editCell.appendChild(editButton);
        }

        // Função para abrir o formulário de edição e preencher os campos com as informações
        function openEditForm(id, professor, date, title) {
            // Preencher os campos do formulário com as informações passadas
            document.getElementById("edit-id").value = id;
            document.getElementById("edit-name").value = professor;
            document.getElementById("edit-date").value = date;
            document.getElementById("edit-type").value = title;

            // Exibir o modal
            document.getElementById("editModal").style.display = "block";
        }

        // Função para fechar o formulário de edição
        function closeEditForm() {
            document.getElementById("editModal").style.display = "none";
        }

        // Fechar o modal se o usuário clicar fora do conteúdo do modal
        window.onclick = function (event) {
            if (event.target == document.getElementById("editModal")) {
                closeEditForm();
            }
        };

        // Função para atualizar o nome do arquivo no botão
        function updateFileName(event, rowIndex) {
            const fileInput = event.target;
            const fileNameDisplay = document.getElementById(`file-name-${rowIndex}`);
            const file = fileInput.files[0];

            if (file) {
                fileNameDisplay.textContent = file.name;  // Exibe o nome do arquivo
            } else {
                fileNameDisplay.textContent = '';  // Caso o usuário não selecione nenhum arquivo
            }
        }
    </script>


</body>

</html>