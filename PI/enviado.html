<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coordenador</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Link CDN do jsPDF -->
</head>

<body>

    <link rel="stylesheet" type="text/css"
        href="https://saopaulo.sp.gov.br/barra-govsp/css/top-padrao-govsp-v2.min.css?vs=3.0">
    <section class="govsp-topo">
        <div id="govsp-topbarGlobal" class="blu-e">
            <div id="topbarGlobal">
                <div id="topbarLink" class="govsp-black">
                    <div class="govsp-portal">
                        <a href="https://www.saopaulo.sp.gov.br" title="nova guia Site Governo do Estado de São Paulo"
                            target="_blank"><img
                                src="https://saopaulo.sp.gov.br/barra-govsp/img/logo-governo-do-estado-sp.png"
                                alt="logomarca Governo de São Paulo" height="38" class="logo">
                        </a>
                    </div>
                </div>
                <nav class="govsp-navbar govsp-navbar-expand-lg">
                    <a class="govsp-link digital" href="https://spmaisdigital.sp.gov.br" title="site SP + Digital">SP +
                        Digital</a>

                    <a class="govsp-social" href="https://www.flickr.com/governosp/"><img class="govsp-icon-social"
                            src="https://saopaulo.sp.gov.br/barra-govsp/img/i-flickr.png"
                            alt="Flickr Governo do Estado de SP" /></a>

                    <a class="govsp-social" href="https://www.linkedin.com/company/governosp/"><img
                            class="govsp-icon-social" src="https://saopaulo.sp.gov.br/barra-govsp/img/i-linkedin.png"
                            alt="Linkedin Governo do Estado de SP" /></a>

                    <a class="govsp-social" href="https://www.tiktok.com/@governosp"><img class="govsp-icon-social"
                            src="https://saopaulo.sp.gov.br/barra-govsp/img/i-tiktok.png"
                            alt="TikTok Governo do Estado de SP" /></a>

                    <a class="govsp-social" href="https://www.youtube.com/governosp/"><img class="govsp-icon-social"
                            src="https://saopaulo.sp.gov.br/barra-govsp/img/i-youtube.png"
                            alt="Youtube Governo do Estado de SP" /></a>

                    <a class="govsp-social" href="https://www.twitter.com/governosp/"><img class="govsp-icon-social"
                            src="https://saopaulo.sp.gov.br/barra-govsp/img/i-twitter.png"
                            alt="Twitter Governo do Estado de SP" /></a>

                    <a class="govsp-social" href="https://www.instagram.com/governosp/"><img class="govsp-icon-social"
                            src="https://saopaulo.sp.gov.br/barra-govsp/img/i-insta.png"
                            alt="Instagram Governo do Estado de SP" /></a>

                    <a class="govsp-social" href="https://www.facebook.com/governosp/"><img class="govsp-icon-social"
                            src="https://saopaulo.sp.gov.br/barra-govsp/img/i-facebook.png"
                            alt="Facebook Governo do Estado de SP" /></a>

                    <p class="govsp-social">/governosp</p>

                    <a class="govsp-acessibilidade" title="nova guia"
                        href="https://www.saopaulo.sp.gov.br/fale-conosco/comunicar-erros/" target="_blank"><img
                            class="govsp-acessibilidade"
                            src="https://saopaulo.sp.gov.br/barra-govsp/img/i-error-report.png"
                            alt="Comunicar um erro"></a>
                </nav>
            </div>
            <button class="govsp-kebab" id="govsp-kebab" aria-expanded="false"><img
                    src="https://saopaulo.sp.gov.br/barra-govsp/img/dots-menu.png" alt="Menu"></button>

            <ul class="govsp-dropdown vs3" id="govsp-dropdown" aria-hidden="true">
                <li><a class="govsp-link digital" role="button" href="https://spmaisdigital.sp.gov.br"
                        title="Site SP + Digital">SP + Digital</a></li>

                <li><a class="govsp-social" role="button" href="https://www.flickr.com/governosp/"><img
                            class="govsp-icon-social" src="https://saopaulo.sp.gov.br/barra-govsp/img/i-flickr.png"
                            alt="Flickr Governo do Estado de SP" /></a></li>

                <li><a class="govsp-social" role="button" href="https://www.linkedin.com/company/governosp/"><img
                            class="govsp-icon-social" src="https://saopaulo.sp.gov.br/barra-govsp/img/i-linkedin.png"
                            alt="Linkedin Governo do Estado de SP" /></a></li>

                <li><a class="govsp-social" role="button" href="https://www.tiktok.com/@governosp"><img
                            class="govsp-icon-social" src="https://saopaulo.sp.gov.br/barra-govsp/img/i-tiktok.png"
                            alt="TikTok Governo do Estado de SP" /></a></li>

                <li><a class="govsp-social" role="button" href="https://www.twitter.com/governosp/"><img
                            class="govsp-icon-social" src="https://saopaulo.sp.gov.br/barra-govsp/img/i-twitter.png"
                            alt="Twitter Governo do Estado de SP" /></a></li>

                <li><a class="govsp-social" role="button" href="https://www.youtube.com/governosp/"><img
                            class="govsp-icon-social" src="https://saopaulo.sp.gov.br/barra-govsp/img/i-youtube.png"
                            alt="Youtube Governo do Estado de SP" /></a></li>

                <li><a class="govsp-social" role="button" href="https://www.instagram.com/governosp/"><img
                            class="govsp-icon-social" src="https://saopaulo.sp.gov.br/barra-govsp/img/i-insta.png"
                            alt="Instagram Governo do Estado de SP" /></a></li>

                <li><a class="govsp-social" role="button" href="https://www.facebook.com/governosp/"><img
                            class="govsp-icon-social" src="https://saopaulo.sp.gov.br/barra-govsp/img/i-facebook.png"
                            alt="Facebook Governo do Estado de SP" /></a></li>

                <li>
                    <p class="govsp-social">/governosp</p>
                </li>
            </ul>
        </div>

        <script src="https://saopaulo.sp.gov.br/barra-govsp/js/script-top-v2.js?vs=3.0"></script>
        <noscript>
            Seu navegador não tem suporte a JavaScript ou está desativado!</noscript>
    </section>

    <div class="logos">
        <img src="logo_fatec_cor.png" width="13%" alt="">
        <img src="cps.png" width="14%" alt="">
    </div>

    <nav>
        <ul>
            <li><a href="login.html">Voltar para o Login</a></li>
            <li><a href="enviado.html">Acompanhamento</a></li>
        </ul>
    </nav>

    <!-- Tabela com os dados enviados -->
    <div class="central">
        <table border="1">
            <thead>
                <tr>
                    <th>Id</th>
                    <th>Nome do Professor</th>
                    <th>Data de Envio</th>
                    <th>Tipo de Atividade</th>
                    <th>Status</th>
                    <th>Edital</th>
                    <th>Relatorio</th>
                </tr>

            </thead>
            <tbody id="formTableBody">
                <!-- Linhas serão adicionadas aqui dinamicamente -->
            </tbody>
        </table>

        <!-- Popup de Justificativa -->
        <div id="justificationModal" class="justification-modal">
            <div class="justification-modal-content">
                <span class="close" onclick="closeJustificationForm()">&times;</span>
                <h2>Justificativa para Status </h2>
                <textarea id="justification-text" rows="4" cols="50"
                    placeholder="Escreva sua justificativa..."></textarea><br>
                <button onclick="submitJustification()">Salvar Justificativa</button>
            </div>
        </div>
    </div>

    <script>
        // Recuperar os dados do localStorage
        const formData = JSON.parse(localStorage.getItem("formData"));

        if (formData) {
            // Adicionar os dados na tabela
            const tableBody = document.getElementById("formTableBody");

            const newRow = tableBody.insertRow();

            // Adicionar células à nova linha
            newRow.insertCell().textContent = new Date().getTime(); // Id gerado com base no timestamp
            newRow.insertCell().textContent = formData.professor;
            newRow.insertCell().textContent = new Date().toLocaleString(); // Data de envio
            newRow.insertCell().textContent = formData.tipoHAE; // Título da HAE

            // Criar célula para Status (Novo campo)
            const statusCell = newRow.insertCell();
            const statusSelect = document.createElement("select");
            statusSelect.className = "status-select";
            const options = ["Deferido", "Indeferido", "Parcial"];
            options.forEach(option => {
                const optionElement = document.createElement("option");
                optionElement.value = option;
                optionElement.textContent = option.charAt(0).toUpperCase() + option.slice(1);
                statusSelect.appendChild(optionElement);
            });

            // Adicionar o evento de mudança de status
            statusSelect.addEventListener("change", handleStatusChange);

            statusCell.appendChild(statusSelect);

            // Criar célula para o primeiro botão de download
            const downloadCell1 = newRow.insertCell();
            const downloadButton1 = document.createElement('button');
            downloadButton1.innerHTML = `
    <svg xmlns="http://www.w3.org/2000/svg" height="50px" viewBox="0 -960 960 960" width="50px" fill="#e8eaed">
        <path d="M480-320 280-520l56-58 104 104v-326h80v326l104-104 56 58-200 200ZM240-160q-33 0-56.5-23.5T160-240v-120h80v120h480v-120h80v120q0 33-23.5 56.5T720-160H240Z"/>
    </svg>
`;
            downloadButton1.addEventListener('click', function () {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                // Adicionar título do PDF
                doc.text("Formulário Enviado", 20, 20);

                // Adicionar os dados do formulário ao PDF
                let yPosition = 30;
                for (const key in formData) {
                    if (formData.hasOwnProperty(key)) {
                        doc.text(`${key}: ${formData[key]}`, 20, yPosition);
                        yPosition += 10;
                    }
                }

                // Salvar o arquivo com o nome específico
                doc.save("formulario_enviado_1.pdf");
            });
            downloadCell1.appendChild(downloadButton1);

            // Criar célula para o segundo botão de download
            const downloadCell2 = newRow.insertCell();
            const downloadButton2 = document.createElement('button');
            downloadButton2.innerHTML = `
    <svg xmlns="http://www.w3.org/2000/svg" height="50px" viewBox="0 -960 960 960" width="50px" fill="#e8eaed">
        <path d="M480-320 280-520l56-58 104 104v-326h80v326l104-104 56 58-200 200ZM240-160q-33 0-56.5-23.5T160-240v-120h80v120h480v-120h80v120q0 33-23.5 56.5T720-160H240Z"/>
    </svg>
`;
            downloadButton2.addEventListener('click', function () {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                // Adicionar título do PDF do Relatório Mensal
                doc.text("Relatório Mensal", 15, 15);

                // Adicionar o conteúdo do relatório mensal
                let yPosition = 30;
                const relatorioMensal = `
        Relatório Mensal: Novembro de 2024

        Este relatório foi gerado com base nos dados fornecidos.

        **Resumo:**
        - Total de alunos: 120
        - Total de aulas realizadas: 15
        - Aulas canceladas: 3

        **Detalhes:**
        As aulas decorreram conforme o planejamento,
        com algumas interrupções devido a imprevistos climáticos.
        A participação dos alunos foi excelente
         e o desempenho geral foi positivo.

        **Recomendações:**
        - Melhorar a comunicação sobre os horários das aulas.
        - Garantir que as aulas possam ser transferidas para 
        outro dia quando houver imprevistos.
    `;

                // Adicionar o relatório no PDF
                doc.text(relatorioMensal, 20, yPosition);

                // Salvar o arquivo com o nome específico
                doc.save("Relatorio_Mensal.pdf");
            });
            downloadCell2.appendChild(downloadButton2);

        }

        // Função para tratar a mudança no status
        function handleStatusChange(event) {
            const status = event.target.value;

            if (status === "Parcial" || status === "Indeferido") {
                openJustificationForm();
            }
        }

        // Função para abrir o formulário de justificativa
        function openJustificationForm() {
            document.getElementById("justificationModal").style.display = "block";
        }

        // Função para fechar o formulário de justificativa
        function closeJustificationForm() {
            document.getElementById("justificationModal").style.display = "none";
        }

        // Função para salvar a justificativa
        function submitJustification() {
            const justification = document.getElementById("justification-text").value;
            console.log("Justificativa salva:", justification);
            closeJustificationForm();
        }

        window.onclick = function (event) {
            if (event.target == document.getElementById("justificationModal")) {
                closeJustificationForm();
            }
        };
    </script>


</body>

</html>